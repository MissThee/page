export enum SVGBgPart {
    circle = 1,
    triangle,
}

const buildBg = (option: { type: SVGBgPart, color?: string }) => {
    switch (option.type) {
        case SVGBgPart.triangle:
            return `
                <g id="bg-triangle">
                    <polygon points="16,0 32,32 0,32" fill="#aaa"/>
                    <polygon points="16,2.5 30,30.5 2,30.5" stroke='white' stroke-width="1" fill="${option?.color || '#f00'}"/>
                </g>`
        case SVGBgPart.circle:
        default:
            return `
                <g id="bg-circle">
                    <circle cx="16" cy="16" r="16" fill="#aaa"/>
                    <circle cx="16" cy="16" r="14" stroke="white" stroke-width="2.5" fill="${option?.color || '#5682FF'}"/>
                </g>`
    }
}

export enum SVGIconPart {
    dot = 1,
    starMulti,
    star,
    person,
    edit
}

const iconPart = {
    [SVGIconPart.dot]: `
      <g id="icon-dot">
        <circle cx="16" cy="16" r="2" fill="#fff"/>
        <circle cx="10" cy="16" r="2" fill="#fff"/>
        <circle cx="22" cy="16" r="2" fill="#fff"/>
    </g>`,
    [SVGIconPart.star]: `
       <g id="icon-star" transform="scale(2.2),translate(2.3000, 1.900000)" fill="#FFFFFF" fill-rule="nonzero">
        <path d="M9.98181998,3.79727395 C9.93959016,3.67057017 9.83017652,3.57842196 9.69772845,3.55730467 L6.6802157,3.09080438 L5.33270047,0.205413709 C5.27319481,0.0806296834 5.14842487,2.03007338e-16 5.01021818,2.03007338e-16 C5.01021818,2.03007338e-16 5.01021818,2.03007338e-16 5.01021818,2.03007338e-16 C4.87201149,2.03007338e-16 4.74724156,0.0787099303 4.6877359,0.205413709 L3.32870345,3.08504512 L0.305432102,3.54002688 C0.172984019,3.55922442 0.0635703925,3.65137262 0.019421039,3.77807641 C-0.0247283144,3.9047802 0.00790381105,4.04492225 0.101961149,4.14090997 L2.29407281,6.39662123 L1.77003911,9.5757343 C1.74700467,9.7101171 1.80459078,9.84641966 1.91592395,9.92512958 C2.02725711,10.0038395 2.17506149,10.0115185 2.29407281,9.94624687 L4.99294236,8.46227682 L7.68605328,9.95584565 C7.73980033,9.98464196 7.79930599,10 7.85881165,10 C7.86073118,10 7.86457026,10 7.86648979,10 C8.06420214,10 8.22352375,9.8406604 8.22352375,9.6429257 C8.22352375,9.59877135 8.2158456,9.55653676 8.2004893,9.51622192 L7.69949005,6.40622 L9.89736034,4.16010751 C9.99141767,4.06411979 10.0240498,3.92397773 9.98181998,3.79727395 Z"/>
    </g>
    `,
    [SVGIconPart.starMulti]: `
     <g id="icon-star-multi" transform="scale(1.35),translate(3.30000, 4.000000)" fill="#FFFFFF" fill-rule="nonzero">
         <path d="M11.9655235,0.580246266 C12.1037301,0.580246266 12.2285001,0.66087595 12.2880057,0.785659975 L12.2880057,0.785659975 L13.635521,3.67105064 L16.6530337,4.13755093 C16.7854818,4.15866823 16.8948954,4.25081644 16.9371252,4.37752022 C16.9793551,4.504224 16.9467229,4.64436606 16.8526656,4.74035378 L16.8526656,4.74035378 L14.6547953,6.98646627 L15.1557946,10.0964682 C15.1711509,10.136783 15.178829,10.1790176 15.178829,10.223172 C15.178829,10.4209067 15.0195074,10.5802463 14.8217951,10.5802463 L14.8217951,10.5802463 C14.7546113,10.5802463 14.6951056,10.5648882 14.6413586,10.5360919 L14.6413586,10.5360919 L11.9670087,9.05224627 L15.4242467,5.40960223 C15.5747384,5.25122249 15.6269498,5.01998809 15.5593821,4.81092686 C15.4918144,4.60186562 15.3167526,4.44982107 15.1048357,4.41497753 L10.2920087,3.64724627 L11.6430412,0.785659975 C11.6906457,0.684296952 11.7800194,0.613649992 11.8846265,0.589445729 Z" />
         <path d="M13.974548,5.31618353 C13.9154262,5.13879824 13.7622471,5.00979074 13.5768198,4.98022653 L9.35230198,4.32712613 L7.46578065,0.287579192 C7.38247274,0.112881557 7.20779482,0 7.01430546,0 C7.01430546,0 7.01430546,0 7.01430546,0 C6.82081609,0 6.64613819,0.110193902 6.56283026,0.287579192 L4.66018482,4.31906316 L0.427604942,4.95603763 C0.242177627,4.98291419 0.0889985494,5.11192167 0.0271894546,5.28930697 C-0.0346196402,5.46669228 0.0110653355,5.66289115 0.142745608,5.79727396 L3.21170193,8.95526972 L2.47805475,13.406028 C2.44580653,13.5941639 2.5264271,13.7849875 2.68229352,13.8951814 C2.83815995,14.0053753 3.04508609,14.0161259 3.21170193,13.9247456 L6.9901193,11.8471876 L10.7604746,13.9381839 C10.8357205,13.9784988 10.9190284,14 11.0023363,14 C11.0050237,14 11.0103984,14 11.0130857,14 C11.289883,14 11.5129332,13.7769246 11.5129332,13.500096 C11.5129332,13.4382799 11.5021838,13.3791515 11.480685,13.3227107 L10.7792861,8.96870801 L13.8563045,5.82415051 C13.9879847,5.68976771 14.0336697,5.49356882 13.974548,5.31618353 Z"/>
     </g>
    `,
    [SVGIconPart.person]: `
     <g id="icon-person" transform="scale(0.02),translate(290.3000, 200.900000)">
         <path d="M733.681778 633.073778a444.970667 444.970667 0 0 0-99.370667-43.349334c99.2-52.565333 166.968889-156.856889 166.968889-276.721777C801.28 140.416 660.864 0 488.263111 0S175.246222 140.416 175.246222 313.002667c0 125.312 74.055111 233.6 180.664889 283.562666-172.956444 61.738667-297.116444 227.128889-297.116444 421.048889h55.352889c0-215.936 175.658667-391.594667 391.594666-391.594666 70.414222 0 139.463111 18.901333 199.68 54.656l28.259556-47.601778zM230.599111 313.002667c0-142.08 115.584-257.664 257.664-257.664s257.664 115.584 257.664 257.664c0 142.065778-115.584 257.649778-257.664 257.649777s-257.664-115.569778-257.664-257.649777zM973.852444 850.161778h-118.499555v-118.485334H800v118.485334h-118.485333v55.352889h118.485333V1024h55.352889v-118.485333h118.499555z" fill="#ffffff"/>
     </g>`,
    [SVGIconPart.edit]: `
     <g id="icon-edit" transform="scale(1.8),translate(-178.1000, -90.200000)" fill="#FFFFFF" fill-rule="nonzero">
         <path d="M192,97.0719952 L192,100.927993 C192,101.515358 191.685581,102.058099 191.175214,102.351771 C190.058421,102.99445 188.94153,103.637032 187.824756,104.279711 C187.314398,104.57343 186.685583,104.57343 186.175224,104.279711 C185.05847,103.637032 183.941676,102.99445 182.824883,102.351771 C182.314473,102.058051 182,101.515316 182,100.927993 L182,97.0719952 C182,96.4846722 182.314473,95.9419175 182.824883,95.6482172 C183.941676,95.005538 185.05847,94.3629364 186.175224,93.7202766 C186.685587,93.4265745 187.314394,93.4265745 187.824756,93.7202766 C188.94153,94.3629558 190.058421,95.005538 191.175214,95.6482172 C191.685575,95.9418951 192,96.4846324 192,97.0719952 Z M187.220787,101.360132 C187.30098,101.352011 187.380713,101.339888 187.459688,101.32381 C187.537614,101.307937 187.614691,101.288173 187.690628,101.264593 C187.765739,101.241323 187.839655,101.214379 187.912106,101.183858 C188.055204,101.123443 188.192111,101.049388 188.320917,100.962724 C188.384665,100.919738 188.446335,100.873767 188.505718,100.824964 C188.624237,100.727441 188.733162,100.618884 188.831015,100.500762 C188.92938,100.382061 189.016009,100.254165 189.089695,100.118857 C189.126933,100.050628 189.160769,99.9806084 189.19108,99.9090543 C189.221759,99.8368762 189.248819,99.7632228 189.272161,99.6883668 C189.295769,99.6126394 189.315604,99.5357945 189.331594,99.4581137 C189.364037,99.2994686 189.380413,99.1379772 189.380476,98.9760703 C189.380413,98.8141378 189.364037,98.6526207 189.331594,98.4939494 C189.3156,98.4162888 189.295764,98.3394635 189.272161,98.2637545 C189.248845,98.1888772 189.221784,98.1152096 189.19108,98.0430281 C189.13057,97.9003695 189.056284,97.7639141 188.969271,97.6355886 C188.839951,97.4448657 188.683843,97.2736242 188.505718,97.1270992 C188.44633,97.0783024 188.384661,97.0323311 188.320917,96.9893393 C188.192109,96.9026837 188.055203,96.8286349 187.912106,96.7682249 C187.839655,96.7377036 187.765739,96.7107593 187.690628,96.6874898 C187.537613,96.6400647 187.380212,96.608058 187.220787,96.5919503 C186.97752,96.5672842 186.731905,96.5795749 186.492325,96.6282918 C186.414364,96.6441421 186.337254,96.6638999 186.261289,96.6874898 C186.186175,96.710753 186.112259,96.7376974 186.03981,96.7682249 C185.825607,96.8586729 185.625669,96.9795512 185.446217,97.1270992 C185.327709,97.2246405 185.218785,97.3332038 185.12092,97.4513201 C185.022635,97.5700533 184.936011,97.6979156 184.86224,97.8331479 C184.787488,97.9704156 184.726376,98.1146367 184.679775,98.2637545 C184.656176,98.3394647 184.63634,98.4162898 184.620341,98.4939494 C184.604237,98.5726409 184.592081,98.6520842 184.583918,98.731983 C184.567409,98.8942595 184.567409,99.0577842 184.583918,99.2200606 C184.592081,99.2999659 184.604237,99.3794156 184.620341,99.4581137 C184.63634,99.5357924 184.656175,99.6126369 184.679775,99.6883668 C184.703186,99.7631994 184.730245,99.8368494 184.760855,99.9090543 C184.791203,99.9805923 184.825038,100.05061 184.86224,100.118857 C184.935974,100.254136 185.0226,100.382027 185.12092,100.500762 C185.169847,100.559774 185.221538,100.616455 185.275821,100.670615 C185.330152,100.724707 185.387014,100.776214 185.446217,100.824964 C185.505609,100.87379 185.567306,100.919762 185.631097,100.962724 C185.759863,101.049396 185.896738,101.123452 186.03981,101.183858 C186.112259,101.214385 186.186175,101.24133 186.261289,101.264593 C186.337258,101.288173 186.414367,101.307937 186.492325,101.32381 C186.571187,101.339876 186.650963,101.352022 186.731168,101.360132 C186.812463,101.368359 186.894206,101.372511 186.975968,101.372511 C187.05773,101.372511 187.139473,101.36834 187.220787,101.360132 L187.220787,101.360132 Z"/>
     </g>`
}

const scaleForTriangle = (icon: string) => `
  <g id="scale-icon-in-triangle" transform="scale(0.66),translate(8.3,17)">
    ${icon}
  </g>
  `

const svgWrapper = (content: string, size: number, isShowRing?: boolean, shapeType?: SVGBgPart) => {
    let borderRadius = ''
    switch (shapeType) {
        case SVGBgPart.circle:
            borderRadius = '50%'
            break;
        case SVGBgPart.triangle:
            borderRadius = '100% 100% 0 0'
            break;
    }
    return `
<svg style="border-radius: ${borderRadius};" width="${size}px" height="${size}px" viewBox="${isShowRing ? '-8 -8 48 48' : '0 0 32 32'}" version="1.1" xmlns="http://www.w3.org/2000/svg">
    ${isShowRing ? '<circle cx="16" cy="16" r="20" stroke="#FFB400" stroke-width="4" fill="none"/>' : ''}
    ${content}
</svg>
`
}

// 构建路线排划地图里使用的各种图标
// bg 图标底图 三角形、圆形
// icon 图标内部图形 三个点、一个星、两个星、小人、螺丝
// color 图标底图颜色 不填则是黑色
// isBig 图标是否是大号的 （地图里多个单在同一点，或者多个工程师住在同一点，图标用大一点儿的）
// isShowRing 图标是否显示高亮圆环 （编辑时有时需要高亮一部分点）
export const buildIcon = (option: { bg: SVGBgPart, icon?: SVGIconPart, color?: string, isBig?: boolean, isShowRing?: boolean }) => {
    const shapeType = option.bg
    const contentBg = buildBg({type: option.bg, color: option.color})
    let contentIcon = ''
    if (option.icon) {
        contentIcon = iconPart[option.icon]
    }
    if (option.bg === SVGBgPart.triangle) {
        contentIcon = scaleForTriangle(contentIcon)
    }
    const size = option.isBig ? (option.isShowRing ? 48 : 32) : (option.isShowRing ? 32 : 20)
    const svg = svgWrapper(contentBg + contentIcon, size, option.isShowRing, shapeType)
    const imgUrl = 'data:image/svg+xml,' + encodeURIComponent(svg) // 拼成svg图片格式
    return {size, svg, imgUrl}
}